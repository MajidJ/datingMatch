<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dating Match</title>
    <!-- Links -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

</head>
<body>
    <div class="container">
        <header>
            <h1>Survey</h1>
        </header>
    </div>
    <div class="container">
        <hr>
        <main>
            <form>
                <div class="form-group">
                    <h2>About You</h2>
                    <div id="errBox" style="color:crimson"></div>
                    <h3>Name:</h3>
                    <label for="name">Please provide your full name:</label>
                    <input type="text" class="form-control" id="name">
                    <h3>Photo:</h3>
                    <label for="name">Please provide a url to a profile photo:</label>
                    <input type="url" class="form-control" id="photo">
                    <hr>
                    <h2>Questions</h2>
                    <div id="errBox2" style="color:crimson"></div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 1</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question1" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 2</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question2" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 3</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question3" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 4</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question4" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 5</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question5" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 6</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question6" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 7</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question7" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 8</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question8" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 9</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question9" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Question 10</h3>
                            <h4>Blah Blah Blah yo</h4>
                            <select id="question10" class="form-control input-lg">
                                <option selected value="6">Select An Option</option>
                                <option value="1">1 (Strongly Disagree)</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5 (Strongly Agree)</option>
                            </select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-primary form-control" id="submit" data-toggle="modal" data-target="#exampleModalCenter">Submit</button>
                        </div>
                    </div>
                </div>
            </form>
        </main>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Here's Your Match!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!-- <div class="row"> -->
                    <div class="modal-body">
                        <div id="matchName"></div>
                        <div id="matchPhoto"></div>
                    </div>
                <!-- </div> -->
                <!-- <div class="row"> -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                    </div>
                <!-- </div> -->
            </div>
        </div>
    </div>
</body>
<!-- Scripts -->
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
        // On submit
        const numQuestions = 10;
        // const path = require("path");
        let firends;
        let person;
        let name;
        let photo;
        let scores;
        $("#submit").on("click", function(event) {
            event.preventDefault();
            // Check if all questions answered
            if ($("#name").val() && $("#photo").val()) {
                name = $("#name").val();
                photo = $("#photo").val();
            } else {
                $("#errBox").text("Please input a valid name and photo URL.");
                document.location+='/#errBox';
                return false;
            }
            scores = [];
            for (let i=1; i<=numQuestions; i++) {
                if (!isNaN($("#question" + i).val())) {
                    let score = parseInt($("#question" + i).val());
                    scores.push(score);
                } else {
                    $("#errBox2").text("Please select a value for all listed questions.");
                    document.location+='/#errBox2';
                    return false;
                }
            }

            // Get values and arrange them into an object
            person = {
                name: name,
                photo: photo,
                scores: scores
            };

            

            $.ajax({url: "/api/friends", method: "GET"}).then(function(response) {
                friends = response;
                let friendScores = [];
                friends.map(eachFriend => {
                    let scoreDifferences = [];
                    eachFriend.scores.map(function(eachScore, i) {
                        scoreDifferences.push(Math.abs(person.scores[i] - eachScore));
                    });
                    let summedDifference = scoreDifferences.reduce(function(acc, val) { return acc + val; });
                    friendScores.push(summedDifference);
                })

                let bestScore = 0;
                let bestMatch;
                friendScores.map(function(matchScore, i) {
                    if (bestScore < matchScore) {
                        bestScore = matchScore;
                        bestMatch = friends[i];
                    }
                });
                
                $("#matchName").empty();
                $("#matchPhoto").empty();
                $("#matchName").append(`<h3>${bestMatch.name}</h3>`);
                $("#matchPhoto").append(`<img src="${bestMatch.photo}" width="300px">`);
                
                updateFriendsData(person);
            }).catch(function(err) {
                if (err) throw err;
            });
            // $.get("/api/friends", function(data){
            //     console.log("Data: " + data);
            // });

            // $.ajax({
            //     method: "GET",
            //     url: "/api/friends",
            // }).then(results => {
            //     console.log("Line 256", results.data);
            //     $.ajax({
            //         method: "POST",
            //         url: "/api/friends",
            //         data: person
            //     }).then(results => {
            //         console.log("Line 262", results2);
            //     }).catch(err => {
            //         if (err) throw err;
            //     });;
            // }).catch(err => {
            //     if (err) throw err;
            // });




            // findMatch(person);
            // post that object using ajax

            // get the friendsArray and loop through it to determine the best match
        });

        function updateFriendsData(inputPerson) {
            $.ajax({
                method: "POST",
                url: "/api/friends",
                data: inputPerson
            })
            // .then(function(response) {
            //     console.log(response);
            // }).fail( function(xhr, textStatus, errorThrown) {
            //     alert(xhr.responseText);
            // });
            
            
            // .catch(err => {
            //     if (err) {
            //         console.log("Some weird err going on", err);
            //     };
            // });;
        };
        
    // function findMatch(inputPerson) {
    //     // let friends;
    //     // $.ajax({
    //     //     method: "GET",
    //     //     url: "/api/friends",
    //     // }).then(results => {
    //     //     friends = results.body 
    //     // });
    //     // console.log(friends);
    //     const friends = require(path.join(__dirname, "../data/friends.js"));

    //     console.log(friends);


    // }

    // post to modal to display best result
</script>
</html>